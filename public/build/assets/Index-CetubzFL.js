import{r as l,W as z,j as e,Y as J,y as K}from"./app-BdDiG5MF.js";import{A as Q}from"./AuthenticatedLayout-CBw7v3pZ.js";import{T as N}from"./TextInput-BnM8wpwZ.js";import{I as X}from"./InputLabel-076v0EPL.js";import{B as Z}from"./button-DTwe3eK1.js";import{P as ee,a as te,C as se,b as ae,c as re,d as ne,e as ie,f as de,g as ce,h as oe,i as le}from"./popover-CZyhr6LC.js";import"./SelectInput-B3moK6NF.js";import"./transition-Dkp8VegQ.js";import"./ThemeToggleButton-yQEJwIpi.js";import"./index-C2fsUSVT.js";function we({auth:c,site_settings:p,customers:x,payments:_}){const[b,g]=l.useState(!1),[u,m]=l.useState(!1),[o,i]=l.useState(null),[k,I]=l.useState(null),[O,F]=l.useState(!1),[E,M]=l.useState(null),w=(x==null?void 0:x.data)||x,{data:f,setData:v,post:V,reset:W,errors:B}=z({customer_id:"",payments:[],total_used:0}),P=()=>{g(!b),b||(W(),i(""))},A=t=>{t.preventDefault(),V(route("bill-payment.store"),{onSuccess:()=>{W(),P()}})},G=t=>{i(t);const n=t.bills.filter(s=>Number(s.won_price)!==Number(s.won_price_paid_amount)||Number(s.shipping_cost)!==Number(s.shipping_cost_paid_amount)).map(s=>({bill_id:s.bill_id,car_chassis:s.car_chassis,won_price:s.won_price,won_price_paid_amount:s.won_price_paid_amount,remain_won_price:s.remain_won_price,won_price_payment:0,shipping_cost:s.shipping_cost,shipping_cost_paid_amount:s.shipping_cost_paid_amount,remain_shipping_cost:s.remain_shipping_cost,shipping_cost_payment:0}));v({customer_id:t.customer_id,payments:n,total_used:0})},D=(t,a,n)=>{const s=[...f.payments];s[t]&&(s[t][a]=n),v(d=>({...d,payments:s}));const r=s.reduce((d,j)=>d+(Number(j.won_price_payment)||0)+(Number(j.shipping_cost_payment)||0),0);i(d=>({...d,total_used:r})),v(d=>({...d,total_used:r}))},{data:y,setData:C,post:Y,reset:R,errors:T}=z({customer_id:"",payments:[],total_used:0,_method:"PUT"}),$=t=>{t.preventDefault(),Y(route("bill-payment.update",k.id),{onSuccess:()=>{R(),S()}})},L=(t,a,n)=>{const s=[...y.payments];s[t][a]=n,C("payments",s);const r=s.reduce((d,j)=>d+(Number(j.won_price_payment)||0)+(Number(j.shipping_cost_payment)||0),0);i(d=>({...d,total_used:r})),C("total_used",r)},S=(t=null)=>{if(t){const a=w.find(n=>n.customer_id===t.customer_id);if(a){i(a);const n=a.bills.filter(s=>t.paid_bills.find(d=>String(d.bill_id)===String(s.bill_id))||Number(s.won_price)!==Number(s.won_price_paid_amount)||Number(s.shipping_cost)!==Number(s.shipping_cost_paid_amount)).map(s=>{const r=t.paid_bills.find(d=>String(d.bill_id)===String(s.bill_id));return{payment_bill_id:r?r.payment_bill_id:null,bill_id:s.bill_id,car_chassis:s.car_chassis,won_price:s.won_price,won_price_paid_amount:s.won_price_paid_amount,remain_won_price:s.remain_won_price,won_price_payment:r?r.won_price_paid_on_bill:0,shipping_cost:s.shipping_cost,remain_shipping_cost:s.remain_shipping_cost,shipping_cost_paid_amount:s.shipping_cost_paid_amount,shipping_cost_payment:r?r.shipping_cost_paid_on_bill:0}});C({customer_id:a.customer_id,payments:n,total_used:Number(t.total_amount),_method:"PUT"}),i(s=>({...s,total_used:t.total_amount})),I(t)}}else I(null),R();m(!u)},q=t=>{window.confirm("هل انت متاكد من حذف عملية تسديد الذمم ؟ ")&&K.delete(route("bill-payment.destroy",t),{onSuccess:a=>{}})},[h,H]=l.useState(null),U=(t=null)=>{if(t){const a=w.find(n=>n.customer_id===t.customer_id);if(H(t),a){i(a);const n=a.bills.map(s=>{const r=t.paid_bills.find(d=>String(d.bill_id)===String(s.bill_id));return r?{payment_bill_id:r.payment_bill_id,bill_id:s.bill_id,car_chassis:s.car_chassis,car_make:s.car_make,car_model:s.car_model,won_price:s.won_price,won_price_paid_amount:s.won_price_paid_amount,remain_won_price:s.remain_won_price,won_price_payment:r.won_price_paid_on_bill,shipping_cost:s.shipping_cost,remain_shipping_cost:s.remain_shipping_cost,shipping_cost_paid_amount:s.shipping_cost_paid_amount,shipping_cost_payment:r.shipping_cost_paid_on_bill}:null}).filter(s=>s!==null);i(s=>({...s,total_used:t.total_amount})),M(n)}else M(null)}F(!O)};return e.jsxs(Q,{user:c.user,site_settings:p,header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight dark:text-gray-200",children:"تسديد ذمم"}),c.user.permissions.includes("create-billPayment")&&e.jsx("button",{onClick:P,className:"px-3 py-1 text-white transition-all rounded shadow bg-burntOrange ",children:"تسديد"})]}),children:[e.jsx(J,{title:p.websiteName+" - تسديد ذمم"}),e.jsx("div",{className:"",children:e.jsx("div",{className:"mx-auto ",children:e.jsx("div",{className:"overflow-hidden overflow-y-auto bg-white shadow-sm dark:bg-gray-800 ",children:e.jsx("div",{className:"p-3 text-gray-900 md:p-3 dark:text-gray-100",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 rtl:text-right dark:text-gray-400",children:[e.jsx("thead",{className:"text-gray-700 uppercase border-b-2 border-gray-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{className:"text-nowrap",children:[e.jsx("th",{className:"p-3",children:"Id"}),e.jsx("th",{className:"p-3",children:"الشركة"}),e.jsx("th",{className:"p-3",children:"القيمة الكليه"}),e.jsx("th",{className:"p-3",children:"تاريخ التحديث"}),e.jsx("th",{className:"p-3",children:"الإجراءات"})]})}),e.jsx("tbody",{children:_&&_.data.length>0?_.data.map(t=>e.jsxs("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("td",{className:"px-3 py-2",children:t.id}),e.jsx("td",{className:"px-3 py-2 text-nowrap",children:t.customer_company}),e.jsx("td",{className:"px-3 py-2 text-nowrap",children:t.total_amount}),e.jsx("td",{className:"px-3 py-2 text-nowrap",children:t.updated_at}),e.jsxs("td",{className:"px-3 py-2 text-nowrap",children:[c.user.permissions.includes("update-billPayment")&&e.jsx("button",{onClick:()=>S(t),className:"mx-1 font-medium text-blue-600 dark:text-blue-500 hover:underline",children:"تعديل"}),c.user.permissions.includes("delete-billPayment")&&e.jsx("button",{onClick:()=>q(t),className:"mx-1 font-medium text-red-600 dark:text-red-500 hover:underline",children:"حذف"}),e.jsx("button",{onClick:()=>U(t),className:"mx-1 font-medium text-emerald-600 dark:text-emerald-500 hover:underline",children:"مشاهدة"})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-3 py-2 text-center",children:"لا يوجد تسديدات"})})})]})})})})})}),b&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"relative w-11/12 max-h-screen overflow-y-auto transition-all duration-300 ease-in-out transform bg-white rounded-lg shadow-lg dark:bg-gray-800 animate-in",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold dark:text-white",children:"إضافة تسديد"})}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:A,children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 mb-3 md:m-0 md:grid-cols-3",children:e.jsxs("div",{className:"flex col-span-1 gap-5 mt-1",children:[e.jsx(X,{className:"mt-1 text-xl text-nowrap",value:"اختر العميل"}),e.jsx(pe,{items:w,onItemSelect:G,placeholder:"اختر العميل",emptyMessage:"لا يوجد عملاء"})]})}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-5 m-6 text-gray-700 md:text-xl dark:text-white",children:[e.jsxs("span",{children:[" رصيد العميل : ",o.customer_balance," "]}),e.jsxs("span",{children:[" رصيد مستخدم : ",o.total_used||0," "]})]}),e.jsxs("table",{className:"w-full text-center text-gray-700 dark:text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"VIN"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Remain"}),e.jsx("th",{className:"p-2 text-xs border-l-2 text-nowrap md:text-base",children:"Pay"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Remain"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Pay"})]})}),e.jsx("tbody",{children:f.payments.length>0?f.payments.map((t,a)=>e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"py-4 border-t border-b",children:t.car_chassis}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_won_price}),e.jsx("td",{className:"py-4 border-t border-b border-l-2",children:e.jsx(N,{type:"number",onChange:n=>D(a,"won_price_payment",n.target.value),max:t.remain_won_price})}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:e.jsx(N,{type:"number",onChange:n=>D(a,"shipping_cost_payment",n.target.value),max:t.remain_shipping_cost})})]},t.car_chassis)):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"py-4 text-center border-t border-b",children:"لا يوجد سيارات"})})})]}),e.jsx("div",{children:e.jsx("ul",{className:"mt-2 text-red-600 list-disc list-inside",children:Object.keys(B).map(t=>e.jsx("li",{children:B[t]},t))})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 text-white bg-gray-600 rounded hover:bg-gray-700",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-white rounded bg-burntOrange ",children:"حفظ"})]})]})})]})}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"relative w-11/12 max-h-screen overflow-y-auto transition-all duration-300 ease-in-out transform bg-white rounded-lg shadow-lg dark:bg-gray-800 animate-in",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold dark:text-white",children:"تعديل التسديد"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex gap-5 m-6 text-gray-700 md:text-xl dark:text-white",children:[e.jsxs("span",{children:[" رصيد العميل : ",o.customer_balance," "]}),e.jsxs("span",{children:[" رصيد مستخدم : ",o.total_used||0," "]})]}),e.jsxs("form",{onSubmit:$,children:[k&&e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-center text-gray-700 dark:text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"VIN"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Remain"}),e.jsx("th",{className:"p-2 text-xs border-l-2 text-nowrap md:text-base",children:"Pay"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Remain"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Pay"})]})}),e.jsx("tbody",{children:y.payments.map((t,a)=>{var n,s;return e.jsxs("tr",{children:[e.jsx("td",{className:"py-4 border-t border-b",children:t.car_chassis}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_won_price}),e.jsx("td",{className:"py-4 border-t border-b border-l-2",children:e.jsx(N,{type:"number",value:((n=y.payments[a])==null?void 0:n.won_price_payment)||0,onChange:r=>L(a,"won_price_payment",r.target.value)})}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:e.jsx(N,{type:"number",value:((s=y.payments[a])==null?void 0:s.shipping_cost_payment)||0,onChange:r=>L(a,"shipping_cost_payment",r.target.value)})})]},t.car_chassis)})})]}),e.jsx("div",{children:e.jsx("ul",{className:"mt-2 text-red-600 list-disc list-inside",children:Object.keys(T).map(t=>e.jsx("li",{children:T[t]},t))})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",onClick:S,className:"px-4 py-2 text-white bg-gray-600 rounded hover:bg-gray-700",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-white rounded bg-burntOrange ",children:"حفظ"})]})]})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"relative w-11/12 max-h-screen overflow-y-auto transition-all duration-300 ease-in-out transform bg-white rounded-lg shadow-lg dark:bg-gray-800 animate-in",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-lg font-semibold dark:text-white",children:"مشاهدة التسديد"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 mb-8 border-b-2 border-gray-500",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-bold lg:text-3xl ",children:p.websiteName}),e.jsx("p",{className:"text-xs lg:text-lg",children:p.phone}),e.jsx("p",{className:"text-xs lg:text-lg",children:p.email})]}),e.jsx("div",{children:e.jsx("img",{src:p.websiteLogo,alt:"Website Logo",className:"h-8 lg:h-16"})})]}),e.jsxs("div",{className:"flex gap-5 m-6 text-gray-700 md:text-xl dark:text-white",children:[e.jsxs("span",{children:[" رصيد العميل : ",o.customer_balance," "]}),e.jsxs("span",{children:[" رصيد مستخدم : ",o.total_used||0," "]})]}),E&&e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-center text-gray-700 dark:text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"VIN"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Make"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Model"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Won Price Remain"}),e.jsx("th",{className:"p-2 text-xs border-l-2 text-nowrap md:text-base",children:"Pay"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Paid"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Shipping Cost Remain"}),e.jsx("th",{className:"p-2 text-xs text-nowrap md:text-base",children:"Pay"})]})}),e.jsx("tbody",{children:E.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-4 border-t border-b",children:t.car_chassis}),e.jsx("td",{className:"py-4 border-t border-b",children:t.car_make}),e.jsx("td",{className:"py-4 border-t border-b",children:t.car_model}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price}),e.jsx("td",{className:"py-4 border-t border-b",children:t.won_price_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_won_price}),e.jsx("td",{className:"py-4 border-t border-b border-l-2",children:t.won_price_payment}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost_paid_amount}),e.jsx("td",{className:"py-4 border-t border-b",children:t.remain_shipping_cost}),e.jsx("td",{className:"py-4 border-t border-b",children:t.shipping_cost_payment})]},t.car_chassis))})]})}),h&&e.jsxs("div",{className:"mt-10 text-gray-700 dark:text-white",children:[e.jsx("h3",{className:"mb-4 text-xl font-bold",children:"تفاصيل السند"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"أنشئ بواسطة:"}),e.jsx("p",{children:h.created_by?h.created_by:"غير متوفر"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"تاريخ الإنشاء:"}),e.jsx("p",{children:h.created_at})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"آخر تعديل بواسطة:"}),e.jsx("p",{children:h.updated_by})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"تاريخ آخر تعديل:"}),e.jsx("p",{children:h.updated_at})]})]})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-6",children:e.jsx("button",{type:"button",onClick:U,className:"px-4 py-2 text-white bg-gray-600 rounded hover:bg-gray-700",children:"غلق"})})]})]})})]})}function pe({items:c,onItemSelect:p,selectedMakeId:x,placeholder:_,emptyMessage:b}){const[g,u]=l.useState(!1),[m,o]=l.useState(x?c.find(i=>i.customer_id===x):null);return e.jsxs(ee,{open:g,onOpenChange:u,children:[e.jsx(te,{asChild:!0,children:e.jsxs(Z,{variant:"outline",role:"combobox","aria-expanded":g,className:"justify-between w-full",children:[m?m.customer_company:_,e.jsx(se,{className:"w-4 h-4 ml-2 opacity-50 shrink-0"})]})}),e.jsx(ae,{className:"w-full p-0",children:e.jsxs(re,{children:[e.jsx(ne,{placeholder:"ابحث عن عميل..."}),e.jsx(ie,{children:c&&c.length===0?e.jsx(de,{children:b}):e.jsx(ce,{children:c.map(i=>e.jsxs(oe,{value:i.customer_company,onSelect:()=>{o(i),p(i),u(!1)},children:[e.jsx(le,{className:`mr-2 h-4 w-4 ${(m==null?void 0:m.customer_id)===i.customer_id?"opacity-100":"opacity-0"}`}),i.customer_company]},i.customer_id))})})]})})]})}export{we as default};
